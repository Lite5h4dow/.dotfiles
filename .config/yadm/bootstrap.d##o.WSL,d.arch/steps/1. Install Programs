#!/bin/bash

cd $HOME

echo "1. Installing Standard Applictions"

if ! command -v git &> /dev/null; then
	echo "git wasnt found... how did you get here?"
	exit
fi

if ! command -v yay &> /dev/null; then
	echo "yay AUR helper wasnt found. building...."
	git clone https://aur.archlinux.org/yay.git $HOME/tmp/yay &> /dev/null
	if ! [ $? -eq 0 ]; then exit 1; fi
	cd $HOME/tmp/yay
	makepkg -sic --noconfirm &> /dev/null
	if ! [ $? -eq 0 ]; then
		cd $HOME
		rm -rf $HOME/tmp
	       	exit 1
	fi
	cd $HOME
	rm -rf $HOME/tmp
fi

echo "doing full system update..."

if ! eval "yay -Syu --noconfirm &> /dev/null"; then
	exit 1
fi


echo "installing default applications..."

if eval "yay -S --noconfirm nvm-git dvm-bin zsh zsh-theme-powerlevel10k-git neovim-nightly-bin lua luajit rustup the_silver_searcher exa &> /dev/null"; then
	printf "successfully installed:\n - Node Version Manager\n - Deno Version Manager\n - ZSH\n - Powerlevel10k\n - Neovim\n - Lua & LuaJIT\n - Rustup\n - The Silver Searcher\n - EXA\n"
else
	echo "failed to install. please check yay's error for the problem. exiting."
	exit 1
fi

echo "adding powerlevel10k to zshrc..."
echo 'source /usr/share/zsh-theme-powerlevel10k/powerlevel10k.zsh-theme' >> ~/.zshrc

if [ $SHELL != "/usr/bin/zsh" ]; then
	echo "default shell isnt ZSH... changing default shell..."
	if eval "chsh -s '/usr/bin/zsh'"; then
		echo "Switched successfully"
	else
		echo "failed to switch. non fatal"
	fi
fi

echo "installing default rust version..."
if eval "rustup default stable &> /dev/null"; then
	echo "installed successfully"
else
	echo "rustup failed"
	exit 1
fi
